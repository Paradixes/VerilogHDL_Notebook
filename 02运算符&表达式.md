# 运算符 & 表达式

## 运算符

**在硬件描述运算符中，运算符代表电路**

（下表运算优先级由高至低）

|      运算符类别       |      Verilog运算符       |              功能              |
| :-------------------: | :----------------------: | :----------------------------: |
| 逻辑运算符&按位运算符 |         `!`, `~`         |         反逻辑、位反向         |
|      算术操作符       |      `*`, `/`, `%`       |          乘、除、取模          |
|      算术操作符       |         `+`, `-`         |             加、减             |
|      移位操作符       |        `<<`, `>>`        |           左移、右移           |
|      关系操作符       |   `<`, `<=`, `>`, `>=`   | 小于、小于等于、大于、大于等于 |
|    相等关系操作符     | `==`, `!=`, `===`, `!==` |     等、不等、全等、非全等     |
|      按位运算符       |           `&`            |             按位与             |
|      按位运算符       |        `^`, `^~`         |   按位逻辑异或、按位逻辑同或   |
|      按位运算符       |           `|`            |           按位逻辑或           |
|      逻辑运算符       |           `&&`           |             逻辑与             |
|      逻辑运算符       |           `||`           |             逻辑或             |
|      条件运算符       |           `?:`           |   三目运算，等同于`if else`    |



### 1. 算术操作符

+ 加法`+`，减法`-`，乘法`*`，除法`/`，取模`%`

+ 算术操作结果的位宽由最长的操作数决定，在赋值语句下，长度由操作左端目标长度决定

  ```verilog
  //eg.
  reg[3:0]A, B, C;
  reg[5:0]D;
  A = B + C;		//4位
  D = B + C;		//6位
  ```

+ 有符号数和无符号数的使用
  
+ 尽可能采用无符号数作为程序设计的基础
  
+ 除法和取模的适配性较差



### 2. 关系操作符

+ 大于`>`，小于`<`，大于等于`>=`，小于等于`<=`

+ 最终会形成1bit信号，`0`、`1`或`x`

  ```verilog
  module rela_tb;
      reg[3:0]a, b, c, d;
      initial
          begin
              a = 3; b = 6; c = 1; d = 4'hx;
              $display(a < b);		//结果为1
              $display(a <= c);		//结果为0
              $display(d <= a);		//结果为x，基本不会遇到该结果
          end
  endmodule
  ```



### 3. 相等关系操作符

+ 等于`==`，不等于`!=`，全等`===`，非全等`!==`

+ 最终会形成1bit信号，`0`、`1`或`x`

+ 等于和全等的区别（全等操作符可以抑制不定状态延伸）

  | `==`  |  0   |  1   |  x   |  z   |
  | :---: | :--: | :--: | :--: | :--: |
  | **0** |  1   |  0   |  x   |  x   |
  | **1** |  0   |  1   |  x   |  x   |
  | **x** |  x   |  x   |  x   |  x   |
  | **z** |  x   |  x   |  x   |  x   |

  | `===` |  0   |  1   |  x   |  z   |
  | :---: | :--: | :--: | :--: | :--: |
  | **0** |  1   |  0   |  0   |  0   |
  | **1** |  0   |  1   |  0   |  0   |
  | **x** |  0   |  0   |  1   |  0   |
  | **z** |  0   |  0   |  0   |  1   |



### 4. 逻辑运算符

+ 逻辑与`&&`，逻辑或`||`，逻辑非`!`
+ 操作数中存在不定态`x`，则逻辑运算的结果也为不定态

|  `a`   |  `b`   |  `!a`  |  `!b`  |`a && b`|`a || b`|
| :----: | :----: | :----: | :----: | :----: | :----: |
|   1    |   0    |   0    |   1    |   0    |   1    |
|   1    |   1    |   0    |   0    |   1    |   1    |
|4'b1110 |4'b0000 |   0    |   1    |   0    |   1    |
|4'b1100 |4'b01x0 |   0    |   x    |   x    |   x    |



### 5. 按位运算符

+ 按位取反`~`，按位与`&`，按位或`|`，按位异或`^`，按位同或`^~`

+ 每一位一一对应进行运算

  ```verilog
  reg [4:0]a, b, c;
  a = 5'b00101;
  b = 5'b11101;
  c = a & b;			//c = 5'b00101
  ```



### 6. 归约运算符

+ 与`&`，或`|`，异或`^`以及相应非操作`~&`，`~|`，`^~`，`~^`

+ 对一个数值的所有位进行对应操作

  ```verilog
  reg [5:0]a = 6'b101011;
  $display("%b", &a);  //1'b0
  $display("%b", |a);  //1'b1
  $display("%b", ^a);  //1'b0
  ```



### 7. 移位操作符

+ 左移操作符`<<`，右移操作符`>>`

+ 将操作数向左（右）移n位，然后用0填补移出的空位

  ```verilog
  reg [5:0]a, b, c;
  reg [7:0]d;
  a = 6'b101101;
  b = a << 2;			//6'b110100
  c = a >> 3;			//6'b000101
  d = a << 2;			//8'b10110100
  ```



### 8. 条件运算符

+ `<条件表达式>?<表达式1>:<表达式2>`

+ 条件表达式的计算结果有`1`，`0`和未知态`x`，当条件表达式结果为1，执行表达式1；为假，则执行表达式2

+ 若表达式为不定态，模拟器将按位对表达式1和2的值进行比较，并按照真值表产生结果值

  ```verilog
  module mux(in1, in2, sel, out);
      input [3:0]in1, in2;
      input sel;
      output [3:0]out;
      reg [3:0]out;
      assign out = (!sel)?in1:in2;
  endmodule
  ```



### 9. 连接和复制运算符

+ 连接运算符`{ }`：信号1的某几位，信号2的某几位······

+ 复制运算符`{{ }}`：将一个表达式放入双重花括号中，复制因子放在第一层括号

  ```verilog
  reg [2:0]a = 3'b101;
  reg [3:0]b = 4'b1110;
  reg [7:0]c = {a, b};			//8'b01011110
  reg [4:0]d = {a[2:1], b[2:0]};	//5'b10110
  reg [5:0]e = {2{a}};			//6'b101101
  ```



## 模块

### 1. 基本概念

+ 模块是 $Verilog\ HDL$ 中的基本单元，它代表一个基本的功能块，用于描述某个设计是功能或结构以及与其它模块通信的外部端口（类似于函数）

+ 一个模块主要包括：模块的开始与结束、模块端口定义、模块结构数据类型说明和模块逻辑功能描述

  + 模块的开始于结束：以关键词`module`开始，以关键词`endmodule`结束
  + 端口定义：用来定义端口列表中哪些是输入、输出和双向端口以及位宽的说明
  + 数据类型说明：在语言上包括`wire`，`reg`，`memory`和`parameter`等类型，用来说明模块中用到的内部信号、调用模块等声明和功能定义语句
  + 逻辑功能描述：用来产生各种逻辑

  ```verilog
  //eg.上升沿D触发器
  module dff(din, clk, q,);	//开始，端口列表
      input din, clk;			//信号类型定义
      output q;
      reg q;
      always@(posedge clk)	//功能描述
          q <= din;
  endmodule					//结束
  ```



### 2. 端口

+ **端口定义**：输入端口`input`，输出端口`output`或双向端口`inout`

+ **模块引用时端口的对应方式**
  + 严格按照模块定义的端口顺序来连接：模块名 实例名（连接端口1信号名，连接端口2信号名，……）
  + 标明源模块定义时规定的端口名：模块名 实例名 （.端口1名（连接信号1名，.端口2名（连接信号2名），……）
  + 可以用端口名与被引用模块的端口对应，不必严格按端口顺序对应，提高程序的可读性